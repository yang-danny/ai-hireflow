name: Lighthouse CI

on:
   pull_request:
      branches: [main]
      paths:
         - 'packages/client/**'
         - '.github/workflows/lighthouse.yml'

jobs:
   lighthouse:
      runs-on: ubuntu-latest
      steps:
         - uses: actions/checkout@v4

         - name: Setup Node.js
           uses: actions/setup-node@v4
           with:
              node-version: '24'
              cache: 'npm'

         - name: Install dependencies
           run: npm ci

         - name: Build client
           run: npm run build --workspace=client

         - name: Run Lighthouse CI
           run: |
              npm install -g @lhci/cli@0.13.x
              lhci autorun
           env:
              LHCI_GITHUB_APP_TOKEN: ${{ secrets.LHCI_GITHUB_APP_TOKEN || secrets.GITHUB_TOKEN }}

         - name: Upload Lighthouse results
           uses: actions/upload-artifact@v4
           if: always()
           with:
              name: lighthouse-results
              path: .lighthouseci
